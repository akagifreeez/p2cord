# P2Cord 開発ロードマップ

## Discord機能

### ✅ 対応済み
| 機能                 | 説明                                 |
| -------------------- | ------------------------------------ |
| ログイン             | Discordトークンによる認証            |
| サーバー一覧         | 参加サーバーの表示                   |
| チャンネル一覧       | テキスト/ボイスチャンネルの表示      |
| メッセージ履歴       | テキストチャンネルのメッセージ閲覧   |
| メッセージ送信       | テキスト/ボイスチャンネルへの投稿    |
| 添付ファイル         | 画像/ファイルの表示                  |
| Embed                | リンクプレビュー、埋め込み表示       |
| スレッド/フォーラム  | 一覧取得、表示、フィルタリング       |
| 検索                 | API + キャッシュによるメッセージ検索 |
| Gateway接続          | リアルタイムイベント受信             |
| メッセージキャッシュ | SQLiteによるローカル保存             |
| **スレッド/フォーラム** | アーカイブ/アクティブスレッドの取得・表示 (Search API Fallback対応) |
| **ソート機能**       | 最新メッセージ順 (`last_message_id`) によるチャンネル/スレッドソート |

### ❌ 未対応 (Low Priority)
| 機能                 | 説明                             | 優先度 |
| -------------------- | -------------------------------- | ------ |
| リアクション         | メッセージへの絵文字リアクション | 低     |
| メンション           | @ユーザー、@ロール、@everyone    | 低     |
| DM                   | ダイレクトメッセージ             | 中     |
| ユーザープロファイル | アバター・ステータス表示         | 低     |
| サーバー設定         | チャンネル作成・権限管理         | 低     |
| 通知                 | メンション・DM通知               | 中     |
| カスタム絵文字       | サーバー絵文字の表示・使用       | 低     |

---

## ボイスチャット / P2P機能

### ✅ 実装済み (2026-01-15 Updated)
| 機能               | 説明                             |
| ------------------ | -------------------------------- |
| **Full Mesh P2P**  | Host/Viewer区別なしの対等接続    |
| **画面共有**       | 複数人同時共有対応               |
| **マイク制御**     | ON/OFF、ミュート、デバイス選択   |
| **VAD**            | 発話検出、アバターハイライト     |
| **UI統合**         | ビデオグリッド + チャットの左右分割レイアウト |
| **ChannelChat**    | ボイスチャンネル内でのテキストチャット・履歴同期 |
| **品質設定**       | AV1優先、解像度/FPS設定 (最大120fps) |
| **接続安定性**     | ハートビート、自動再接続、TURN設定 |
| **Focused View**   | クリックによる画面拡大・フォーカス |

### 🔄 実装予定
| 機能             | 説明                                    | 優先度 |
| ---------------- | --------------------------------------- | ------ |
| **リモート操作** | マウス/キーボード入力のP2P送信 (Full Mesh対応) | 高     |
| 音量調整         | マスター音量・個別ユーザー音量          | 中     |
| ノイズキャンセル | AIベースのノイズ除去                    | 中     |
| Push-to-Talk     | キーを押している間だけ送信              | 中     |
| エコーキャンセル | 音声フィードバック防止                  | 中     |

---

## 最近の更新履歴 (2026-01-14 ~ 01-15)

*   **Discord Integration**: フォーラム・スレッド対応の強化、API制限回避策（Search API）の実装。
*   **Voice Chat UI**: `ChatPanel` を廃止し `ChannelChat` へ統合。メッセージ履歴の同期バグ修正。
*   **Performance**: メッセージリストのスクロール制御改善（Pagination対応）、画像のEmbed表示対応。
*   **Stream Quality**: Adaptive Bitrate Control連携、AV1コーデックの安定化。

---

## 技術的課題

### 要調査
- [ ] webrtc-rsのメディアストリーム取得方法（画面共有用）の最適化
- [ ] 複数TrackのMultiplex対応の詳細検証
- [ ] TURNサーバー設定の永続化（UI実装済み、Backend連携確認）

### 既知の制限
- Discordの公式ボイスサーバーは使用不可（独自P2Pのみを使用）
- ユーザートークンが必要（Bot tokenは非対応）

---

*最終更新: 2026-01-15*
